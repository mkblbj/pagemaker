# 自定义模块编辑功能 - 使用指南

## 📖 功能概述

自定义 HTML 模块现在支持直接在画布中编辑文字和替换图片，无需手动修改 HTML 代码！

## 🎯 如何使用

### 1. 进入编辑模式

**方法：双击自定义模块的任意位置**

- 模块标题栏会变成蓝色背景
- 显示 "✏️ 编辑模式" 标识
- 出现 "完成编辑" 按钮

**提示：** 未进入编辑模式时，标题栏会显示 "(双击进入编辑)" 提示

### 2. 编辑文字

**进入编辑模式后：**

1. **鼠标悬停**在任何文本上
   - 会显示虚线边框
   - 弹出 "双击编辑" 提示气泡

2. **双击文本**进入编辑状态
   - 文本背景变为浅蓝色
   - 边框变为实线蓝色
   - 光标出现，可以直接输入

3. **编辑内容**
   - 可以修改文字
   - 可以删除内容
   - 保留原有的 HTML 格式（颜色、粗体等）

4. **保存修改**
   - 点击文本外部任意位置
   - 或按 `Esc` 键
   - 修改自动保存

### 3. 替换图片

**进入编辑模式后：**

1. **鼠标悬停**在图片上
   - 图片会显示蓝色边框
   - 透明度略微降低

2. **单击图片**
   - 自动打开图片选择对话框

3. **选择新图片**
   - 从 R-Cabinet 选择已有图片
   - 或上传新图片

4. **确认选择**
   - 图片自动替换
   - 修改自动保存

### 4. 退出编辑模式

**方法一：** 点击标题栏的 "完成编辑" 按钮

**方法二：** 点击模块外部的其他区域

## 🎨 视觉提示说明

### 非编辑模式
```
┌─────────────────────────────────────────┐
│ 🎨 自定义HTML模块 (双击进入编辑)        │ ← 灰色背景
├─────────────────────────────────────────┤
│                                         │
│  正常显示 HTML 内容                      │
│                                         │
└─────────────────────────────────────────┘
```

### 编辑模式
```
┌─────────────────────────────────────────┐
│ 🎨 自定义HTML模块 ✏️ 编辑模式 [完成编辑] │ ← 蓝色背景
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────┐  双击编辑 ↑            │
│  │ 可编辑文本   │ ← 虚线边框              │
│  └─────────────┘                        │
│                                         │
│  [图片] ← 悬停显示边框，点击替换         │
│                                         │
└─────────────────────────────────────────┘
```

### 编辑文字时
```
┌─────────────────────────────────────────┐
│ 🎨 自定义HTML模块 ✏️ 编辑模式 [完成编辑] │
├─────────────────────────────────────────┤
│                                         │
│  ┌─────────────────┐                   │
│  │ 可编辑文字|     │ ← 蓝色背景 + 光标   │
│  └─────────────────┘                   │
│                                         │
└─────────────────────────────────────────┘
```

## ⚠️ 注意事项

### 支持的内容
- ✅ 表格中的文字
- ✅ 段落文字
- ✅ 列表项
- ✅ 带颜色的文字（保留原有颜色）
- ✅ 带格式的文字（粗体、斜体等）
- ✅ 图片（单击替换）

### 限制
- ⚠️ 不能编辑 HTML 结构（如添加/删除表格行列）
- ⚠️ 不能修改样式（如背景色、边框）
- ⚠️ 链接暂不支持编辑（需要通过"查看代码"修改）

### 最佳实践
1. **先双击模块**进入编辑模式，再编辑内容
2. **编辑完成后**点击"完成编辑"或保存页面
3. **大量修改**时建议使用"查看代码"功能
4. **定期保存**页面以防丢失修改

## 🚀 使用场景

### 场景 1：快速修改商品说明
```
原文: ※在庫状況により変動致しますので
修改: ※在庫状況により変動する場合がございます
```
**操作：** 双击模块 → 双击文字 → 修改 → 点击外部

### 场景 2：更换商品图片
```
原图: product-old.jpg
新图: product-new.jpg
```
**操作：** 双击模块 → 点击图片 → 选择新图 → 确认

### 场景 3：批量修改表格内容
```
修改多个表格单元格的文字
```
**操作：** 双击模块进入编辑模式 → 依次双击各个单元格编辑 → 完成编辑

## 🔧 故障排查

### 问题：双击没有进入编辑模式
- **检查：** 是否双击了模块区域（不是其他地方）
- **解决：** 在模块边框内的空白处双击

### 问题：双击文字没有反应
- **检查：** 是否已进入编辑模式（标题栏显示 "✏️ 编辑模式"）
- **解决：** 先双击模块进入编辑模式

### 问题：修改没有保存
- **检查：** 是否点击了"保存"按钮
- **解决：** 编辑后点击页面顶部的"保存"按钮

### 问题：图片点击没有打开选择器
- **检查：** 是否已进入编辑模式
- **解决：** 先双击模块进入编辑模式，再点击图片

## 📝 技术说明

- 使用 iframe 隔离渲染，保证样式不受干扰
- 在 iframe 内部注入编辑脚本
- contentEditable API 实现文字编辑
- 集成 R-Cabinet 图片选择器
- 实时同步修改到 customHTML 字段

---

**文档版本**: v1.0  
**最后更新**: 2025-10-07  
**作者**: AI Assistant 🤖

