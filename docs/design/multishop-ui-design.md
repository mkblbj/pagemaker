# 多店铺支持 - 前端 UI 设计方案

## 设计目标

1. **高效筛选**: 用户能够快速切换不同店铺查看页面
2. **性能优化**: 支持上百页面的分页显示
3. **状态保持**: URL 保存筛选条件，支持刷新和分享
4. **用户体验**: 简洁直观的界面，减少点击次数

## 核心设计决策

### ✅ 采用方案：店铺选择器 + 分页

**原因**:
- ✅ 一次只显示一个店铺的页面，避免列表过长
- ✅ 支持分页，适合大量页面场景（上百页面）
- ✅ 切换店铺快速简单（下拉选择）
- ✅ 可以组合设备类型筛选
- ✅ URL 可分享和保存状态

### ❌ 不采用方案：分组折叠/展开

**原因**:
- ❌ 店铺页面过多时，需要滚动很久才能到下一个店铺
- ❌ 性能问题：一次加载所有店铺的所有页面
- ❌ 分页困难：不同店铺页面数不同
- ❌ 用户体验差：需要大量滚动

## UI 设计详情

### 1. 页面列表 - 店铺选择模式

```
┌──────────────────────────────────────────────────────────────┐
│  📄 页面管理                                                  │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  🏪 店铺: [0901 (0901) ▼]    📱 设备: [全部 ▼]   [+ 新建页面] │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 首页                                          [PC]    │   │
│  │ 最后更新: 2025-10-10 15:30                           │   │
│  │ 模块数: 5                                             │   │
│  │                                      [编辑] [删除]    │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 促销活动页面                                  [Mobile] │   │
│  │ 最后更新: 2025-10-09 10:15                           │   │
│  │ 模块数: 8                                             │   │
│  │                                      [编辑] [删除]    │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 产品详情页                                     [PC]    │   │
│  │ 最后更新: 2025-10-08 14:20                           │   │
│  │ 模块数: 12                                            │   │
│  │                                      [编辑] [删除]    │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
│  ┌──────────────────────────────────────────────────────┐   │
│  │ 关于我们                                       [PC]    │   │
│  │ 最后更新: 2025-10-07 09:45                           │   │
│  │ 模块数: 3                                             │   │
│  │                                      [编辑] [删除]    │   │
│  └──────────────────────────────────────────────────────┘   │
│                                                              │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│       « 上一页    1  2  3  ...  10  11  12    下一页 »        │
│                      共 230 个页面                            │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 2. 创建页面表单

```
┌──────────────────────────────────────────────────────────────┐
│  + 创建新页面                                                 │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  页面名称 *                                                  │
│  ┌────────────────────────────────────────────────────┐     │
│  │                                                    │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  店铺 *                                                      │
│  ┌────────────────────────────────────────────────────┐     │
│  │ 0901 (0901)                                    ▼  │     │
│  └────────────────────────────────────────────────────┘     │
│  ℹ️ 从当前选中的店铺预填                                     │
│                                                              │
│  设备类型 *                                                  │
│  ○ PC端    ● 移动端                                          │
│                                                              │
│  页面内容                                                    │
│  ┌────────────────────────────────────────────────────┐     │
│  │ [模块编辑器...]                                    │     │
│  │                                                    │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│                                    [取消]  [创建页面]        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

### 3. 编辑页面表单

```
┌──────────────────────────────────────────────────────────────┐
│  ✏️ 编辑页面                                                  │
├──────────────────────────────────────────────────────────────┤
│                                                              │
│  页面名称 *                                                  │
│  ┌────────────────────────────────────────────────────┐     │
│  │ 首页                                               │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  店铺 (不可修改)                                              │
│  ┌────────────────────────────────────────────────────┐     │
│  │ 🏪 0901 (0901)                                     │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│  设备类型 (不可修改)                                          │
│  [PC]                                                        │
│                                                              │
│  页面内容                                                    │
│  ┌────────────────────────────────────────────────────┐     │
│  │ [模块编辑器...]                                    │     │
│  │                                                    │     │
│  └────────────────────────────────────────────────────┘     │
│                                                              │
│                                    [取消]  [保存更改]        │
│                                                              │
└──────────────────────────────────────────────────────────────┘
```

## URL 结构设计

### 页面列表
```
/pages?shop_id=c6ee0826-7c17-46b7-b408-c1ed74de0651&device_type=pc&page=1
```

参数说明:
- `shop_id`: 当前选中的店铺ID（必需）
- `device_type`: 设备类型筛选（可选：pc/mobile/all）
- `page`: 当前页码（可选，默认1）

### 创建页面
```
/pages/new?shop_id=c6ee0826-7c17-46b7-b408-c1ed74de0651
```

参数说明:
- `shop_id`: 预填的店铺ID（从列表页传递）

### 编辑页面
```
/pages/edit/[pageId]?from_shop=c6ee0826-7c17-46b7-b408-c1ed74de0651
```

参数说明:
- `from_shop`: 返回时恢复的店铺筛选（可选）

## 交互流程

### 流程 1: 查看不同店铺的页面

```
1. 用户打开页面列表
   ↓
2. 默认选中第一个店铺，显示该店铺的页面
   ↓
3. 用户点击店铺下拉框，选择"店铺2"
   ↓
4. 列表自动刷新，显示店铺2的页面
   ↓
5. URL 更新为: ?shop_id=xxx&page=1
```

### 流程 2: 创建页面

```
1. 用户在列表页选中"店铺1"
   ↓
2. 点击"新建页面"按钮
   ↓
3. 打开创建表单，店铺字段预填"店铺1"
   ↓
4. 用户可以修改店铺选择
   ↓
5. 选择设备类型（PC/Mobile）
   ↓
6. 填写页面名称和内容
   ↓
7. 点击"创建页面"
   ↓
8. 创建成功，返回列表页
   ↓
9. 列表页保持原来的店铺筛选状态
```

### 流程 3: 编辑页面

```
1. 用户在列表页点击某页面的"编辑"按钮
   ↓
2. 打开编辑表单，显示页面信息
   ↓
3. 店铺和设备类型显示为只读（不可修改）
   ↓
4. 用户修改页面名称或内容
   ↓
5. 点击"保存更改"
   ↓
6. 返回列表页，保持原来的店铺筛选状态
```

## 技术实现要点

### 1. 状态管理

```typescript
// 使用 URL 参数管理筛选状态
const searchParams = useSearchParams();
const shopId = searchParams.get('shop_id');
const deviceType = searchParams.get('device_type') || 'all';
const page = parseInt(searchParams.get('page') || '1');

// 更新筛选条件
const updateFilter = (newShopId, newDeviceType, newPage = 1) => {
  const params = new URLSearchParams();
  params.set('shop_id', newShopId);
  if (newDeviceType !== 'all') {
    params.set('device_type', newDeviceType);
  }
  params.set('page', newPage.toString());
  router.push(`/pages?${params.toString()}`);
};
```

### 2. API 调用

```typescript
// 获取页面列表（带店铺筛选和分页）
const fetchPages = async (shopId: string, deviceType?: string, page = 1) => {
  const params = new URLSearchParams({
    shop_id: shopId,
    limit: '20',
    offset: ((page - 1) * 20).toString(),
  });
  
  if (deviceType && deviceType !== 'all') {
    params.set('device_type', deviceType);
  }
  
  const response = await fetch(`/api/v1/pages/?${params.toString()}`);
  return response.json();
};
```

### 3. 默认店铺选择

```typescript
// 组件挂载时的逻辑
useEffect(() => {
  // 如果 URL 没有 shop_id，选择第一个店铺
  if (!shopId && shops.length > 0) {
    updateFilter(shops[0].id, 'all', 1);
  }
}, [shops, shopId]);
```

## 性能优化

1. **按需加载**: 只加载当前选中店铺的页面
2. **分页显示**: 每页20条，避免一次加载过多数据
3. **缓存策略**: 使用 SWR 缓存不同店铺的页面列表
4. **虚拟滚动**: 如果单页内容过多，可使用虚拟滚动优化

## 多语言文本

### 中文
- 店铺: 店铺
- 选择店铺: 选择店铺
- 设备类型: 设备类型
- PC端: PC端
- 移动端: 移动端
- 全部: 全部
- 共 X 个页面: 共 {count} 个页面

### 英文
- 店铺: Shop
- 选择店铺: Select Shop
- 设备类型: Device Type
- PC端: PC
- 移动端: Mobile
- 全部: All
- 共 X 个页面: Total {count} pages

### 日语
- 店铺: ショップ
- 选择店铺: ショップを選択
- 设备类型: デバイスタイプ
- PC端: PC
- 移动端: モバイル
- 全部: すべて
- 共 X 个页面: 合計 {count} ページ

## 验收标准

### 功能完整性
- [x] 店铺选择器显示所有店铺
- [x] 选择店铺后只显示该店铺的页面
- [x] 设备类型筛选工作正常
- [x] 分页功能正常（每页20条）
- [x] URL 参数正确保存筛选状态

### 用户体验
- [x] 默认选中第一个店铺
- [x] 切换店铺响应快速（< 500ms）
- [x] 刷新页面保持筛选状态
- [x] 创建页面时预填当前店铺
- [x] 编辑页面后返回保持筛选状态

### 性能
- [x] 页面列表加载时间 < 1s
- [x] 切换店铺无闪烁
- [x] 支持上百页面的分页显示
- [x] 无内存泄漏

### 兼容性
- [x] 支持 Chrome/Firefox/Safari 最新版
- [x] 响应式设计（桌面端优先）
- [x] 支持三语切换（中/英/日）

