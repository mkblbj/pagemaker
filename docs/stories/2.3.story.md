# Story 2.3: 页面/模板管理视图框架

## Status: aprroved

## Story

**As a** 运营专员,
**I want** 能有一个"页面管理"视图，可以列表形式清晰地查看我所有创建的页面或自定义布局模板，并能按文件夹/店铺进行组织,
**so that** 我能有效地管理我的工作成果。

## Acceptance Criteria

1. CMS中应有清晰的入口进入"页面/模板管理"视图。
2. 视图以列表形式展示所有已创建的页面/模板。
3. 列表至少显示名称、类型、最后修改日期。
4. 视图提供按文件夹或店铺名称进行筛选或分组的功能。
5. 列表中的每一行为后续的管理操作预留UI占位符。
6. 视图中应包含"创建新页面"的按钮。

## Tasks / Subtasks

- [ ] 创建页面管理路由和页面组件 (AC: 1, 2)
  - [ ] 在 `app/(protected)/pages/` 创建管理页面路由
  - [ ] 创建 `PageManagementView` 主组件
  - [ ] 配置受保护路由布局
- [ ] 实现页面列表数据获取和显示 (AC: 2, 3)
  - [ ] 创建 `pageService.getPages()` API服务函数
  - [ ] 使用 SWR 实现数据获取和缓存
  - [ ] 创建 `PageListItem` 组件显示页面信息
  - [ ] 实现列表容器和布局
- [x] 实现筛选和分组功能 (AC: 4)
  - [x] 创建店铺/文件夹筛选器组件
  - [x] 实现按店铺分组显示逻辑
  - [x] 添加筛选状态管理
- [ ] 添加管理操作占位符和创建按钮 (AC: 5, 6)
  - [ ] 在列表项中添加操作按钮占位符
  - [ ] 创建"创建新页面"按钮组件
  - [ ] 实现导航到编辑器的基础逻辑
- [ ] 实现响应式设计和样式 (All ACs)
  - [ ] 使用 Tailwind CSS 实现响应式布局
  - [ ] 确保在移动端和桌面端的良好显示
- [ ] 添加单元测试和集成测试
  - [ ] 为 `PageManagementView` 组件编写单元测试
  - [ ] 为 `pageService` 编写测试
  - [ ] 为筛选和分组功能编写测试

## Dev Notes

### Previous Story Insights
从 Story 2.1 的完成记录中获得的关键经验：
- 模块架构设计优秀，完美复用了现有组件功能
- 类型定义完整且扩展性好，与现有模块注册系统无缝集成
- 建议考虑使用 React.memo 优化性能
- 需要注意 XSS 防护，特别是处理用户输入时

### Data Models
**PageTemplate 接口** [Source: architecture/data-models.md#模型-1-pagetemplate-页面模板]:
```typescript
interface PageModule {
  id: string; // 模块实例的唯一ID
  type: 'title' | 'text' | 'image' | 'separator' | 'keyValue' | 'multiColumn'; // 模块类型
  [key: string]: any; // 其他配置属性
}

interface PageTemplate {
  id: string;
  name: string;
  content: PageModule[];
  targetArea: string;
  ownerId: string;
  createdAt: string; // ISO 8601 Date String
  updatedAt: string; // ISO 8601 Date String
}
```

### API Specifications
**页面列表获取接口** [Source: architecture/rest-api-spec.md#/pages/]:
- `GET /api/v1/pages/`: 获取页面/模板列表
- 需要 Bearer Token 认证
- 返回 PageTemplate 数组
- 响应状态码 200 表示成功

### Component Specifications
**状态管理架构** [Source: architecture/frontend-architecture.md#状态管理架构]:
- 使用 **Zustand** 作为状态管理库
- 在 `src/stores/` 目录下创建功能域相关的 Store
- `usePageStore.ts`: 管理当前正在编辑的页面核心数据

**API集成架构** [Source: architecture/frontend-architecture.md#api集成架构]:
- HTTP客户端使用 **Axios**
- 数据获取和缓存使用 **SWR**
- 集中的 Axios 实例位于 `src/lib/apiClient.ts`
- 服务层位于 `src/services/` 目录

### File Locations
基于项目结构 [Source: architecture/unified-project-structure.md]:
- 主页面组件: `apps/frontend/app/(protected)/pages/page.tsx`
- 页面管理组件: `apps/frontend/src/components/feature/PageManagementView.tsx`
- 页面服务: `apps/frontend/src/services/pageService.ts`
- 页面状态管理: `apps/frontend/src/stores/usePageStore.ts` (如需新增)
- API客户端: `apps/frontend/src/lib/apiClient.ts` (已存在)

### Technical Constraints
**编码规范** [Source: architecture/coding-standards.md]:
- 前端使用 `camelCase`/`PascalCase` 命名约定
- 必须使用共享类型: 前后端共享的数据结构必须在 `packages/shared-types` 中定义
- 必须使用服务层: 前端组件严禁直接调用 `axios` 或 `fetch`
- 严禁硬编码: 所有常量值必须在专门的常量文件中定义

**路由架构** [Source: architecture/frontend-architecture.md#路由架构]:
- 使用 Next.js App Router 的路由组 (Route Groups) 保护需要认证的页面
- 所有需要登录的页面放置在 `(protected)` 文件夹中
- 在 `app/(protected)/layout.tsx` 中检查用户登录状态

### Testing
**测试策略** [Source: architecture/testing-strategy.md]:
- **测试框架**: Vitest + React Testing Library
- **文件位置**: 测试文件 (`.test.tsx`) 与被测试的组件文件并置存放
- **测试范围**: 单元测试和集成测试
- **Mocking**: 测试中所有外部依赖（API、Store）必须被模拟 (Mock)

**测试运行方式**:
```bash
# 运行前端测试
cd apps/frontend
pnpm test

# 运行测试并生成覆盖率
pnpm test -- --coverage
```

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|---------|
| 2024-12-19 | 1.0 | 初始故事创建 | Scrum Master |

## PO Validation Findings

### Validation Status: ✅ APPROVED (GO)
**实现准备度评分**: 9/10  
**信心水平**: 高  
**验证日期**: 2024-12-19  
**验证者**: Product Owner (Sarah)

### Should-Fix Issues (Important Quality Improvements)

#### 1. 安全考虑详细化
- **问题**: 当前安全要求相对基础，缺乏具体的数据访问权限检查要求
- **建议**: 
  - 添加具体的数据访问权限检查要求到Dev Notes
  - 明确用户只能看到自己创建的页面的安全约束
  - 在API服务层添加所有权验证的技术要求
- **影响**: 中等 - 影响数据安全和用户隐私
- **优先级**: 高
- **状态**: 待处理

#### 2. 错误处理场景完善
- **问题**: 缺乏API调用失败和异常情况的处理指导
- **建议**:
  - 在任务中明确API调用失败时的处理方式
  - 添加网络错误、权限错误等场景的用户体验要求
  - 指定错误消息的显示策略和用户友好的错误提示
- **影响**: 中等 - 影响用户体验和系统稳定性
- **优先级**: 中
- **状态**: 待处理

### Nice-to-Have Improvements (Optional Enhancements)

#### 1. 性能优化指导
- **建议**:
  - 添加大量页面时的分页或虚拟滚动考虑
  - 列表更新时的优化策略（如增量更新、缓存策略）
  - SWR缓存配置的具体建议
- **影响**: 低 - 提升大数据量场景下的性能
- **优先级**: 低
- **状态**: 未来考虑

#### 2. 用户体验细节优化
- **建议**:
  - 加载状态的具体展示要求（骨架屏、加载动画等）
  - 筛选操作的用户反馈机制（筛选结果数量、清除筛选等）
  - 空状态页面的设计要求（无页面时的引导）
- **影响**: 低 - 提升整体用户体验
- **优先级**: 低
- **状态**: 未来考虑

### 跟踪和后续行动

1. **立即行动**: 故事已批准实现，可分配给开发代理
2. **监控要点**: 在开发过程中特别关注安全权限检查和错误处理的实现
3. **迭代改进**: 将上述改进点纳入后续故事的标准模板中
4. **经验积累**: 基于此次验证经验，优化未来的故事验证清单

## Dev Agent Record

### Agent Model Used
Claude 3.5 Sonnet (20241022)

### Debug Log References
无调试问题

### Completion Notes List
- ✅ 已实现按店铺分组展示功能
- ✅ 添加了视图模式切换（网格视图 vs 分组视图）
- ✅ 分组视图按店铺名称排序，每组内页面按更新时间排序
- ✅ 增强了页面统计信息，显示店铺数量

### File List
- apps/frontend/src/app/(protected)/pages/page.tsx (修改)

## QA Results
待QA代理填写 